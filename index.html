<!DOCTYPE html>
<html>
<head>
  <title>Простий чат</title>
  <style>
    body { font-family: Arial; }
    #messages { list-style-type: none; margin: 0; padding: 0; }
    #messages li { padding: 5px 10px; display: flex; justify-content: space-between; align-items: center; }
    #messages li:nth-child(odd) { background: #eee; }
    button.delete { margin-left: 10px; }
    form { display: flex; }
    input { flex: 1; padding: 10px; }
    button.send { padding: 10px; }
  </style>
</head>
<body>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="input" autocomplete="off" placeholder="Введи повідомлення..." />
    <button class="send">Надіслати</button>
  </form>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');

    // Надсилання нового повідомлення
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (input.value) {
        socket.emit('chat message', input.value);
        input.value = '';
      }
    });

    // Додавання повідомлення на сторінку
    socket.on('chat message', (msg) => {
      addMessage(msg);
    });

    // Функція для додавання повідомлення у список із кнопкою "Видалити"
    function addMessage(msg) {
      const item = document.createElement('li');
      const textSpan = document.createElement('span');
      textSpan.textContent = msg;

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Видалити';
      deleteBtn.className = 'delete';
      deleteBtn.addEventListener('click', () => deleteMessage(msg, item));

      item.appendChild(textSpan);
      item.appendChild(deleteBtn);
      messages.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }

    // Функція видалення повідомлення
    function deleteMessage(msg, element) {
      fetch('/messages', {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: msg })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          element.remove();
        } else {
          alert('Не вдалося видалити повідомлення');
        }
      })
      .catch(err => console.error(err));
    }
  </script>
</body>
</html>
